#!/usr/bin/env python3
"""
VSCodeì—ì„œ ì‹¤í–‰í•˜ëŠ” ì›Œë“œ íŒŒì¼ ì¼ê´„ PDF ë³€í™˜ê¸°
"""

import os
import sys
from pathlib import Path
from docx2pdf import convert
import time

def print_header():
    """í”„ë¡œê·¸ë¨ í—¤ë” ì¶œë ¥"""
    print("=" * 60)
    print("ğŸ”„ ì›Œë“œ íŒŒì¼ â†’ PDF ë³€í™˜ê¸° (VSCodeìš©)")
    print("=" * 60)

def get_word_files(folder_path):
    """ì›Œë“œ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°"""
    folder = Path(folder_path)
    if not folder.exists():
        print(f"âŒ í´ë”ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤: {folder_path}")
        return []
    
    word_files = []
    extensions = ['.doc', '.docx']
    
    for ext in extensions:
        word_files.extend(folder.glob(f'*{ext}'))
        word_files.extend(folder.glob(f'**/*{ext}'))  # í•˜ìœ„ í´ë” í¬í•¨
    
    return word_files

def convert_single_file(word_file, output_folder):
    """ë‹¨ì¼ íŒŒì¼ ë³€í™˜"""
    try:
        output_path = Path(output_folder)
        output_path.mkdir(parents=True, exist_ok=True)
        
        pdf_file = output_path / f"{word_file.stem}.pdf"
        
        print(f"ğŸ”„ ë³€í™˜ ì¤‘: {word_file.name}")
        convert(str(word_file), str(pdf_file))
        print(f"âœ… ì™„ë£Œ: {pdf_file.name}")
        return True
        
    except Exception as e:
        print(f"âŒ ì‹¤íŒ¨: {word_file.name} - {str(e)}")
        return False

def batch_convert(input_folder, output_folder):
    """ì¼ê´„ ë³€í™˜"""
    print(f"\nğŸ“‚ ì…ë ¥ í´ë”: {input_folder}")
    print(f"ğŸ“ ì¶œë ¥ í´ë”: {output_folder}")
    
    # ì›Œë“œ íŒŒì¼ ì°¾ê¸°
    word_files = get_word_files(input_folder)
    
    if not word_files:
        print("\nâŒ ì›Œë“œ íŒŒì¼(.doc, .docx)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return
    
    print(f"\nğŸ“Š ë°œê²¬ëœ ì›Œë“œ íŒŒì¼: {len(word_files)}ê°œ")
    for i, file in enumerate(word_files, 1):
        print(f"  {i}. {file.name}")
    
    # ë³€í™˜ ì‹œì‘
    print(f"\nğŸš€ ë³€í™˜ì„ ì‹œì‘í•©ë‹ˆë‹¤...")
    start_time = time.time()
    
    success_count = 0
    fail_count = 0
    
    for word_file in word_files:
        if convert_single_file(word_file, output_folder):
            success_count += 1
        else:
            fail_count += 1
        time.sleep(0.1)  # ì‹œìŠ¤í…œ ë¶€í•˜ ë°©ì§€
    
    # ê²°ê³¼ ì¶œë ¥
    end_time = time.time()
    elapsed_time = end_time - start_time
    
    print("\n" + "=" * 60)
    print("ğŸ“Š ë³€í™˜ ê²°ê³¼")
    print("=" * 60)
    print(f"âœ… ì„±ê³µ: {success_count}ê°œ")
    print(f"âŒ ì‹¤íŒ¨: {fail_count}ê°œ")
    print(f"â±ï¸ ì†Œìš” ì‹œê°„: {elapsed_time:.2f}ì´ˆ")
    print("=" * 60)

def interactive_mode():
    """ëŒ€í™”í˜• ëª¨ë“œ"""
    print_header()
    
    while True:
        print("\nğŸ“ ì‚¬ìš© ë°©ë²•:")
        print("1. ì›Œë“œ íŒŒì¼ì´ ìˆëŠ” í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•˜ì„¸ìš”")
        print("2. PDFë¥¼ ì €ì¥í•  í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•˜ì„¸ìš”")
        print("3. 'quit' ì…ë ¥ì‹œ ì¢…ë£Œ")
        
        # ì…ë ¥ í´ë”
        input_folder = input("\nğŸ“‚ ì…ë ¥ í´ë” ê²½ë¡œ: ").strip()
        if input_folder.lower() == 'quit':
            print("ğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break
            
        if not input_folder:
            print("âŒ í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
            continue
        
        # ì¶œë ¥ í´ë”
        output_folder = input("ğŸ“ ì¶œë ¥ í´ë” ê²½ë¡œ: ").strip()
        if output_folder.lower() == 'quit':
            print("ğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break
            
        if not output_folder:
            print("âŒ ì¶œë ¥ í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
            continue
        
        # ë³€í™˜ ì‹¤í–‰
        batch_convert(input_folder, output_folder)
        
        # ê³„ì† ì—¬ë¶€ í™•ì¸
        continue_choice = input("\nğŸ”„ ë‹¤ë¥¸ í´ë”ë„ ë³€í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ").strip().lower()
        if continue_choice not in ['y', 'yes']:
            print("ğŸ‘‹ í”„ë¡œê·¸ë¨ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.")
            break

def command_line_mode():
    """ëª…ë ¹í–‰ ì¸ìˆ˜ ëª¨ë“œ"""
    if len(sys.argv) != 3:
        print("ì‚¬ìš©ë²•: python word_to_pdf_converter.py <ì…ë ¥í´ë”> <ì¶œë ¥í´ë”>")
        print("ì˜ˆì‹œ: python word_to_pdf_converter.py ./docs ./pdfs")
        return
    
    input_folder = sys.argv[1]
    output_folder = sys.argv[2]
    
    print_header()
    batch_convert(input_folder, output_folder)

# VSCodeì—ì„œ ì§ì ‘ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì„¤ì •
if __name__ == "__main__":
    try:
        # ëª…ë ¹í–‰ ì¸ìˆ˜ê°€ ìˆìœ¼ë©´ ëª…ë ¹í–‰ ëª¨ë“œ, ì—†ìœ¼ë©´ ëŒ€í™”í˜• ëª¨ë“œ
        if len(sys.argv) > 1:
            command_line_mode()
        else:
            interactive_mode()
    except KeyboardInterrupt:
        print("\n\nâš ï¸ ì‚¬ìš©ìì— ì˜í•´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.")
    except Exception as e:
        print(f"\nâŒ ì˜¤ë¥˜ ë°œìƒ: {str(e)}")
        print("ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.")